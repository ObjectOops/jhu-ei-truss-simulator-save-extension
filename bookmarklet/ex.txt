const%20savedStatusText%20%3D%20%22saved%22%3B%0Aconst%20unsavedStatusText%20%3D%20%22unsaved%22%3B%0Aconst%20noneStatusText%20%3D%20%22-%22%3B%0A%0Alet%20remoteUrlForm%20%3D%20Object.assign(document.createElement(%22input%22)%2C%20%7B%0A%20%20%20%20type%3A%20%22text%22%2C%20%0A%20%20%20%20placeholder%3A%20%22enter%20server%20address...%22%0A%7D)%3B%20%2F%2F%20Add%20to%20main%20menu.%0Alet%20remoteAuthForm%20%3D%20Object.assign(document.createElement(%22input%22)%2C%20%7B%0A%20%20%20%20type%3A%20%22text%22%2C%20%0A%20%20%20%20placeholder%3A%20%22token%20(optional)...%22%0A%7D)%3B%0Alet%20remoteUploadEndpointForm%20%3D%20Object.assign(document.createElement(%22input%22)%2C%20%7B%0A%20%20%20%20type%3A%20%22text%22%2C%20%0A%20%20%20%20placeholder%3A%20%22upload%20endpoint%20(optional)...%22%0A%7D)%3B%0Alet%20remoteLoadEndpointForm%20%3D%20Object.assign(document.createElement(%22input%22)%2C%20%7B%0A%20%20%20%20type%3A%20%22text%22%2C%20%0A%20%20%20%20placeholder%3A%20%22load%20endpoint%20(optional)...%22%0A%7D)%3B%0A%0Alet%20statusIndicator%20%3D%20Object.assign(document.createElement(%22span%22)%2C%20%7B%0A%20%20%20%20textContent%3A%20%60save%20status%3A%20%24%7BunsavedStatusText%7D%60%0A%7D)%3B%0A%0Alet%20saveDataElem%20%3D%20document.getElementById(%22IDelemSaveTruss%22)%3B%0Alet%20saveDataNameForm%20%3D%20document.getElementById(%22IDelemFileName%22)%3B%0Alet%20loadDataElem%20%3D%20document.getElementById(%22IDelemLoadTruss%22)%3B%0A%0A(function()%20%7B%0A%20%20%20%20if%20(window.location.href%20!%3D%3D%20%22https%3A%2F%2Fei.jhu.edu%2Ftruss-simulator%2F%22)%20%7B%0A%20%20%20%20%20%20%20%20verify%20%3D%20prompt(%22This%20page%20may%20not%20be%20the%20truss%20simulator.%20Continue%20Y%2FN%3F%22).toLowerCase()%3B%0A%20%20%20%20%20%20%20%20if%20(verify%20%3D%3D%3D%20%22n%22%20%7C%7C%20verify%20%3D%3D%3D%20%22no%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20if%20(globalThis.loadOnce%20!%3D%3D%20undefined)%20%7B%0A%20%20%20%20%20%20%20%20alert(%22Already%20loaded.%22)%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20globalThis.loadOnce%20%3D%20true%3B%0A%0A%20%20%20%20let%20headMenu%20%3D%20document.body%3B%0A%20%20%20%20let%20mainMenu%20%3D%20document.getElementById(%22IDelemSaveSubmenu%22)%3B%20%2F%2F%20Menu%20under%20%5BImport%20%26%20Export%5D.%0A%20%20%20%20let%20saveMenu%20%3D%20document.getElementById(%22IDelemSaveAs%22)%3B%20%2F%2F%20Menu%20under%20%5BSave%20as%20file%5D.%0A%0A%20%20%20%20let%20uploadSaveButton%20%3D%20document.createElement(%22button%22)%3B%20%2F%2F%20Add%20to%20save%20menu.%0A%20%20%20%20uploadSaveButton.innerHTML%20%3D%20internalButton(%22upload%20to%20server%22%2C%20extensionUpload)%3B%0A%0A%20%20%20%20%2F%2F%20let%20loadSaveForm%20%3D%20Object.assign(document.createElement(%22input%22)%2C%20%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20type%3A%20%22text%22%2C%20%0A%20%20%20%20%2F%2F%20%20%20%20%20placeholder%3A%20%22enter%20load%20file%20name...%22%0A%20%20%20%20%2F%2F%20%7D)%3B%20%2F%2F%20Add%20to%20main%20menu.%0A%20%20%20%20let%20loadSaveButton%20%3D%20document.createElement(%22button%22)%3B%20%2F%2F%20Add%20to%20main%20menu.%0A%20%20%20%20loadSaveButton.innerHTML%20%3D%20internalButton(%22load%20from%20server%22%2C%20extensionLoad)%3B%0A%0A%20%20%20%20headMenu.prepend(document.createElement(%22br%22))%3B%0A%20%20%20%20headMenu.prepend(statusIndicator)%3B%0A%0A%20%20%20%20mainMenu.appendChild(remoteUrlForm)%3B%0A%20%20%20%20mainMenu.appendChild(remoteAuthForm)%3B%0A%20%20%20%20mainMenu.appendChild(remoteUploadEndpointForm)%3B%0A%20%20%20%20mainMenu.appendChild(remoteLoadEndpointForm)%3B%0A%20%20%20%20%2F%2F%20mainMenu.appendChild(loadSaveForm)%3B%0A%20%20%20%20mainMenu.appendChild(loadSaveButton)%3B%0A%0A%20%20%20%20saveMenu.appendChild(uploadSaveButton)%3B%0A%7D)()%3B%0A%0Afunction%20internalButton(label%2C%20func)%20%7B%0A%20%20%20%20return%20%60%3Ca%20onclick%3D%22%24%7Bfunc.name%7D()%3B%22%3E%3Ci%20style%3D%22font-size%3A%2013px%3B%20margin-bottom%3A%200px%22%3E%24%7Blabel%7D%3C%2Fi%3E%60%3B%0A%7D%0A%0Afunction%20getRemoteStr(endpoint%2C%20name)%20%7B%0A%20%20%20%20let%20baseUrl%20%3D%20remoteUrlForm.value%20%2B%20(remoteUrlForm.value.endsWith(%22%2F%22)%20%3F%20%22%22%20%3A%20%22%2F%22)%3B%0A%20%20%20%20let%20query%20%3D%20%60%24%7BencodeURIComponent(endpoint)%7D%3Ftoken%3D%24%7BencodeURIComponent(remoteAuthForm.value)%7D%26name%3D%24%7BencodeURIComponent(name)%7D%60%0A%20%20%20%20return%20encodeURI(baseUrl%20%2B%20query)%3B%0A%7D%0A%0Afunction%20extensionUpload()%20%7B%0A%20%20%20%20window.writeFile()%3B%20%2F%2F%20Called%20from%20the%20simulator's%20%60main.js%60.%0A%20%20%20%20let%20data%20%3D%20decodeURIComponent(saveDataElem.href.replace(%22data%3Atext%2Fjson%3Bcharset%3Dutf-8%2C%22%2C%20%22%22))%3B%0A%20%20%20%20statusIndicator.textContent%20%3D%20%22saving...%22%3B%0A%0A%20%20%20%20fetch(getRemoteStr(remoteUploadEndpointForm.value%2C%20saveDataNameForm.value.length%20%3D%3D%3D%200%20%3F%20%22truss%22%20%3A%20saveDataNameForm.value)%2C%20%7B%0A%20%20%20%20%20%20%20%20method%3A%20%22POST%22%2C%20%0A%20%20%20%20%20%20%20%20headers%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Content-Type%22%3A%20%22application%2Fjson%22%0A%20%20%20%20%20%20%20%20%7D%2C%20%0A%20%20%20%20%20%20%20%20body%3A%20data%0A%20%20%20%20%7D)%0A%20%20%20%20.then(response%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20if%20(!response.ok)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%60code%20%24%7Bresponse.status%7D%60)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%0A%20%20%20%20.then(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20statusIndicator.textContent%20%3D%20%60save%20status%3A%20%24%7BsavedStatusText%7D%60%0A%20%20%20%20%7D)%0A%20%20%20%20.catch((error)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20statusIndicator.textContent%20%3D%20%60save%20status%3A%20ERROR%20%24%7Berror%7D%60%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20setTimeout(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20statusIndicator.textContent%20%3D%20%60save%20status%3A%20%24%7BnoneStatusText%7D%60%3B%0A%20%20%20%20%7D%2C%205000)%3B%0A%7D%0A%0Afunction%20extensionLoad()%20%7B%0A%20%20%20%20trussName%20%3D%20prompt(%22Truss%20Name%22)%3B%0A%20%20%20%20fetch(getRemoteStr(remoteLoadEndpointForm.value%2C%20trussName)%2C%20%7B%0A%20%20%20%20%20%20%20%20method%3A%20%22GET%22%0A%20%20%20%20%7D)%0A%20%20%20%20.then(response%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20if%20(!response.ok)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20Error(%60code%20%24%7Bresponse.status%7D%60)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20response.blob()%3B%0A%20%20%20%20%7D)%0A%20%20%20%20.then(data%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20let%20fakeFile%20%3D%20new%20File(%5Bdata%5D%2C%20%22truss.json%22)%3B%0A%20%20%20%20%20%20%20%20let%20dataTransfer%20%3D%20new%20DataTransfer()%3B%0A%20%20%20%20%20%20%20%20dataTransfer.items.add(fakeFile)%3B%0A%20%20%20%20%20%20%20%20loadDataElem.files%20%3D%20dataTransfer.files%3B%0A%0A%20%20%20%20%20%20%20%20window.readFile()%3B%20%2F%2F%20Called%20from%20the%20simulator's%20%60main.js%60.%0A%0A%20%20%20%20%20%20%20%20statusIndicator.textContent%20%3D%20%60save%20status%3A%20LOADED%20%24%7BunsavedStatusText%7D%60%3B%0A%20%20%20%20%7D)%0A%20%20%20%20.catch((error)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20statusIndicator.textContent%20%3D%20%60load%20status%3A%20ERROR%20%24%7Berror%7D%60%3B%0A%20%20%20%20%7D)%3B%0A%7D%0A
